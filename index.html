<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Alvaro Sanchez-Mariscal">
<title>Micronaut Workshop</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1><span class="image"><img src="https://raw.githubusercontent.com/micronaut-projects/static-website/gh-pages/images/favicon-32x32.png" alt="favicon 32x32"></span> <a href="https://alvarosanchez.github.io/micronaut-workshop/">Micronaut Workshop</a></h1>
<div class="details">
<span id="author" class="author">Alvaro Sanchez-Mariscal</span><br>
<span id="email" class="email"><a href="mailto:alvaro.sanchezmariscal@gmail.com">alvaro.sanchezmariscal@gmail.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_software_requirements">Software Requirements</a>
<ul class="sectlevel2">
<li><a href="#_micronaut_cli">Micronaut CLI</a></li>
<li><a href="#_clone_this_repository">Clone this repository</a></li>
</ul>
</li>
<li><a href="#_application_architecture">Application architecture</a></li>
<li><a href="#_getting_started_with_the_micronaut_cli_25_minutes">1. Getting started with the Micronaut CLI (25 minutes)</a>
<ul class="sectlevel2">
<li><a href="#_listing_profiles_3_minutes">1.1. Listing profiles (3 minutes)</a></li>
<li><a href="#_getting_information_about_a_profile_2_minutes">1.2. Getting information about a profile (2 minutes)</a></li>
<li><a href="#_creating_and_running_a_hello_galaxy_15_minutes">1.3. Creating and running a <em>hello galaxy</em> (15 minutes)</a></li>
<li><a href="#_write_an_automated_test_5_minutes">1.4. Write an automated test (5 minutes)</a></li>
</ul>
</li>
<li><a href="#_creating_the_clubs_microservice_70_minutes">2. Creating the Clubs microservice (70 minutes)</a>
<ul class="sectlevel2">
<li><a href="#_gorm_layer_15_minutes">2.1. GORM layer (15 minutes)</a></li>
<li><a href="#_rest_api_30_minutes">2.2. REST API (30 minutes)</a></li>
<li><a href="#_load_some_data_for_production_15_minutes">2.3. Load some data for production (15 minutes)</a></li>
<li><a href="#_register_the_service_in_consul_10_minutes">2.4. Register the service in Consul (10 minutes)</a></li>
</ul>
</li>
<li><a href="#_creating_the_fixtures_microservice_70_minutes">3. Creating the Fixtures microservice (70 minutes)</a>
<ul class="sectlevel2">
<li><a href="#_data_layer_35_minutes">3.1. Data layer (35 minutes)</a></li>
<li><a href="#_rest_api_35_minutes">3.2. REST API (35 minutes)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<a href="https://github.com/alvarosanchez/micronaut-workshop"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
<div class="paragraph">
<p>Introductory workshop about <a href="http://micronaut.io">Micronaut</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_requirements">Software Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to do this workshop, you need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linux or MacOS with shell access, and the following installed:</p>
<div class="ulist">
<ul>
<li>
<p><code>curl</code>.</p>
</li>
<li>
<p><code>wget</code>.</p>
</li>
<li>
<p><code>unzip</code>.</p>
</li>
<li>
<p><code>git</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>JDK 8.</p>
</li>
<li>
<p>Docker. Please pull the following images before attending the workshop:</p>
<div class="ulist">
<ul>
<li>
<p><code>consul</code>.</p>
</li>
<li>
<p><code>mongo</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_micronaut_cli">Micronaut CLI</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <a href="http://sdkman.io">SDKMAN!</a> if you haven&#8217;t done so already.</p>
</li>
<li>
<p>Install Micronaut CLI:</p>
<div class="literalblock">
<div class="content">
<pre>$ sdk install micronaut</pre>
</div>
</div>
</li>
<li>
<p>Ensure the CLI is installed properly:</p>
<div class="literalblock">
<div class="content">
<pre>$ mn --version
| Micronaut Version: 1.0.0.M3
| JVM Version: 1.8.0_131</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_clone_this_repository">Clone this repository</h3>
<div class="paragraph">
<p>Once done, you can clone this repo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://github.com/alvarosanchez/micronaut-workshop.git</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You will find each exercise&#8217;s template files on each <code>exNN</code> folder. Solution is always inside a <code>solution</code> folder. To highlight the actions you actually need to perform, an icon is used: <span class="icon"><i class="fa fa-hand-o-right"></i></span>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_architecture">Application architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Throughout this workshop, we will be creating a football (soccer) management system.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/football-diagram.png" alt="football diagram">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clubs</code> is the microservice responsible for managing clubs. It uses GORM for
Hibernate as a data access layer.</p>
</li>
<li>
<p><code>fixtures</code> manages all game fixtures, storing its data in MongoDB. For the
teams playing in a game, it doesn&#8217;t store their full details, but rather their
ID. It has a service-discovery-enabled HTTP client to fetch club details from
the <code>clubs</code> microservice.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_with_the_micronaut_cli_25_minutes">1. Getting started with the Micronaut CLI (25 minutes)</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Change to the <code>ex01</code> directory to work on this exercise
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Micronaut CLI is the recommended way to create new Micronaut projects. The
CLI includes commands for generating specific categories of projects, allowing
you to choose between build tools, test frameworks, and even pick the language
you wish to use in your application. The CLI also provides commands for generating
artifacts such as controllers, client interfaces, and serverless functions.</p>
</div>
<div class="paragraph">
<p>The <code>create-app</code> command is the starting point for creating Micronaut applications.
The CLI is based on the concept of <strong>profiles</strong>. A profile consist of a project
template (or skeleton), optional features, and profile-specific commands. Commands
from a profile typically are specific to the profile application type; for example,
the <code>service</code> profile (designed for creation of microservice applications) provides
the <code>create-controller</code> and <code>create-client</code> commands.</p>
</div>
<div class="sect2">
<h3 id="_listing_profiles_3_minutes">1.1. Listing profiles (3 minutes)</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> You can list the available profiles with the <code>list-profiles</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn list-profiles
| Available Profiles
--------------------
* function-aws - The function profile for AWS Lambda
* function - The function profile
* federation - The federation profile
* service - The service profile
* base - The base profile</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Micronaut team is actively working on new profiles, and eventually they
will be available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Applications generated from a profile can be personalised with <strong>features</strong>. A
feature further customises the newly created project by adding additional
dependencies to the build, more files to the project skeleton, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getting_information_about_a_profile_2_minutes">1.2. Getting information about a profile (2 minutes)</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> To see all the features of a profile, you can
use the <code>profile-info</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn profile-info service
| Profile: service
--------------------
The service profile

| Provided Commands:
--------------------
  create-bean        Creates a singleton bean
  create-client      Creates a client interface
  create-controller  Creates a controller and associated test
  create-job         Creates a job with scheduled method
  help               Prints help information for a specific command

| Provided Features:
--------------------
  annotation-api    Adds Java annotation API
  config-consul     Adds support for Distributed Configuration with Consul (https://www.consul.io)
  discovery-consul  Adds support for Service Discovery with Consul (https://www.consul.io)
  discovery-eureka  Adds support for Service Discovery with Eureka
  groovy            Creates a Groovy application
  hibernate-gorm    Adds support for GORM persistence framework
  hibernate-jpa     Adds support for Hibernate/JPA
  http-client       Adds support for creating HTTP clients
  http-server       Adds support for running a Netty server
  java              Creates a Java application
  jdbc-dbcp         Configures SQL DataSource instances using Commons DBCP
  jdbc-hikari       Configures SQL DataSource instances using Hikari Connection Pool
  jdbc-tomcat       Configures SQL DataSource instances using Tomcat Connection Pool
  jrebel            Adds support for class reloading with JRebel (requires separate JRebel installation)
  junit             Adds support for the JUnit testing framework
  kafka             Adds support for Kafka
  kotlin            Creates a Kotlin application
  mongo-gorm        Configures GORM for MongoDB for Groovy applications
  mongo-reactive    Adds support for the Mongo Reactive Streams Driver
  neo4j-bolt        Adds support for the Neo4j Bolt Driver
  neo4j-gorm        Configures GORM for Neo4j for Groovy applications
  picocli           Adds support for command line parsing (http://picocli.info)
  redis-lettuce     Configures the Lettuce driver for Redis
  security-jwt      Adds support for JWT (JSON Web Token) based Authentication
  security-session  Adds support for Session based Authentication
  spek              Adds support for the Spek testing framewokr
  spock             Adds support for the Spock testing framework
  springloaded      Adds support for class reloading with Spring-Loaded
  tracing-jaeger    Adds support for distributed tracing with Jaeger (https://www.jaegertracing.io)
  tracing-zipkin    Adds support for distributed tracing with Zipkin (https://zipkin.io)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_and_running_a_hello_galaxy_15_minutes">1.3. Creating and running a <em>hello galaxy</em> (15 minutes)</h3>
<div class="paragraph">
<p>As explained avobe, the <code>create-app</code> command can be used to create new projects.
It accepts some flags:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Create-App Flags</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build tool (one of <code>gradle</code>, <code>maven</code> - default is <code>gradle</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-build maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile to use for the project (default is <code>service</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-profile function-aws</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>features</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features to use for the project, comma-separated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-features security-jwt,mongo-gorm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inplace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, generates the project in the current directory (project name is optional if this flag is set)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-inplace</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Let&#8217;s create a <em>hello galaxy</em> project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app hello-galaxy --features groovy
| Application created at /private/tmp/hello-galaxy</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Currently, <a href="https://github.com/micronaut-projects/micronaut-profiles/issues/28">there is a bug</a>
in the CLI that makes it generate a main <code>Application.java</code> class regardless of
the <code>groovy</code> feature being selected. However, the main <code>Application</code> class can be
left as is, and we will work with Groovy with the rest of the project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, move into the generated <code>hello-galaxy</code> folder and let&#8217;s
create a controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-controller hello
| Rendered template Controller.groovy to destination src/main/groovy/hello/galaxy/HelloController.groovy
| Rendered template ControllerSpec.groovy to destination src/test/groovy/hello/galaxy/HelloControllerSpec.groovy</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Open the generated <code>HelloController.groovy</code> with your favourite
IDE and make it return "Hello Micronauts!":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-nd">@Get</span><span class="tok-o">(</span><span class="tok-s2">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-n">String</span> <span class="tok-nf">index</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-s2">&quot;Hello Galaxy!&quot;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, run the application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ MICRONAUT_SERVER_PORT=8080 ./gradlew run</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Micronaut by default runs on a random port. This helps running multiple
instances of a service. However, the port can be easily fixed by setting a
configuration variable, or simply by exposing an environment variable as we
did with <code>MICRONAUT_SERVER_PORT=8080</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will see a line similar to the following once the application has started</p>
</div>
<div class="literalblock">
<div class="content">
<pre>14:40:01.187 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 957ms. Server Running: http://localhost:8080</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, on another shell, make a request to your service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ curl 0:8080/hello
Hello Galaxy!</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_write_an_automated_test_5_minutes">1.4. Write an automated test (5 minutes)</h3>
<div class="paragraph">
<p>While testing manually is acceptable in some situations, going forward it is
better to have automated tests to exercise our applications. Fortunately,
Micronaut makes testing super easy!</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Change the generated <code>src/test/groovy/hello/galaxy/HelloControllerSpec.groovy</code>
to look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-kd">class</span> <span class="tok-nc">HelloControllerSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Shared</span> <span class="tok-nd">@AutoCleanup</span> <span class="tok-n">EmbeddedServer</span> <span class="tok-n">embeddedServer</span> <span class="tok-o">=</span> <span class="tok-n">ApplicationContext</span><span class="tok-o">.</span><span class="tok-na">run</span><span class="tok-o">(</span><span class="tok-n">EmbeddedServer</span><span class="tok-o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nd">@Shared</span> <span class="tok-nd">@AutoCleanup</span> <span class="tok-n">RxHttpClient</span> <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">applicationContext</span><span class="tok-o">.</span><span class="tok-na">createBean</span><span class="tok-o">(</span><span class="tok-n">RxHttpClient</span><span class="tok-o">,</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">getURL</span><span class="tok-o">())</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test index&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
        <span class="tok-n">String</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">toBlocking</span><span class="tok-o">().</span><span class="tok-na">retrieve</span><span class="tok-o">(</span><span class="tok-s2">&quot;/hello&quot;</span><span class="tok-o">)</span> <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="tok-nl">expect:</span>
        <span class="tok-n">response</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Hello Galaxy!&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Running an embedded server</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtaining a reactive HTTP client attached to our embedded server</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>As the client is non-blocking by default, we want to block in tests to make sure
we get a result before the test finishes. Also, the <code>retrieve</code> method returns
the response as a String.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, run the tests:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./gradlew test</pre>
</div>
</div>
<div class="paragraph">
<p>Once finished, you should see an output similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>BUILD SUCCESSFUL in 6s</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_the_clubs_microservice_70_minutes">2. Creating the Clubs microservice (70 minutes)</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Change to the <code>ex02/clubs</code> directory to work on this exercise. The project
has been already created for you, no need to run <code>mn create-app</code> this time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this exercise we are creating the <code>clubs</code> microservice.</p>
</div>
<div class="sect2">
<h3 id="_gorm_layer_15_minutes">2.1. GORM layer (15 minutes)</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Let&#8217;s define first a <code>Club</code> domain class under
<code>src/main/groovy/clubs/domain/Club.groovy</code> with 2 string attributes:
<code>name</code> (mandatory) and <code>stadium</code> (optional).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Unlike Grails, when using GORM in Micronaut you need to annotate your
entities with <code>grails.gorm.annotation.Entity</code>, as in Micronaut there is no
conventional folder such as <code>grails-app/domain</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Next, define a
<a href="http://gorm.grails.org/latest/hibernate/manual/index.html#dataServices">GORM data service</a>
named <code>ClubService</code> as an interface with the following operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-kt">int</span> <span class="tok-nf">count</span><span class="tok-o">()</span>
<span class="tok-n">Club</span> <span class="tok-nf">save</span><span class="tok-o">(</span><span class="tok-nd">@NotBlank</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-nd">@NotBlank</span> <span class="tok-n">String</span> <span class="tok-n">stadium</span><span class="tok-o">)</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Club</span><span class="tok-o">&gt;</span> <span class="tok-n">findAll</span><span class="tok-o">()</span>
<span class="tok-n">Club</span> <span class="tok-nf">find</span><span class="tok-o">(</span><span class="tok-nd">@NotNull</span> <span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">)</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
GORM Data Services are annotated with <code>grails.gorm.services.Service</code>, taking
as an argument the entity they operate with. In this case, it would be <code>@Service(Club)</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, let&#8217;s test our service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-nd">@Rollback</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">class</span> <span class="tok-nc">ClubServiceSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Shared</span> <span class="tok-nd">@AutoCleanup</span> <span class="tok-n">EmbeddedServer</span> <span class="tok-n">embeddedServer</span> <span class="tok-o">=</span> <span class="tok-n">ApplicationContext</span><span class="tok-o">.</span><span class="tok-na">run</span><span class="tok-o">(</span><span class="tok-n">EmbeddedServer</span><span class="tok-o">)</span>
    <span class="tok-nd">@Shared</span> <span class="tok-n">ClubService</span> <span class="tok-n">service</span> <span class="tok-o">=</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-n">ClubService</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;it can work with clubs&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">expect:</span>
        <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>

        <span class="tok-nl">when:</span>
        <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;Real Madrid CF&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Bernabeu&quot;</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span>
        <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>

        <span class="tok-nl">when:</span>
        <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Club</span><span class="tok-o">&gt;</span> <span class="tok-n">clubs</span> <span class="tok-o">=</span> <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span>
        <span class="tok-n">clubs</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">1</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;it can show a club&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
        <span class="tok-n">Club</span> <span class="tok-n">club</span> <span class="tok-o">=</span> <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;CD Leganes&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Butarque&quot;</span><span class="tok-o">)</span>

        <span class="tok-nl">when:</span>
        <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">find</span><span class="tok-o">(</span><span class="tok-n">club</span><span class="tok-o">.</span><span class="tok-na">id</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span>
        <span class="tok-n">club</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;CD Leganes&quot;</span>
        <span class="tok-n">club</span><span class="tok-o">.</span><span class="tok-na">stadium</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Butarque&quot;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>grails.gorm.transactions.Rollback</code> applies a transaction that always rolls back.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Instead of any kind of injection, we simply get the bean from the application context.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_rest_api_30_minutes">2.2. REST API (30 minutes)</h3>
<div class="paragraph">
<p>Micronaut helps you writing both the client and server sides of a REST API. In this service,
we are going to create the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/clubs-diagram.png" alt="clubs diagram">
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Create the <code>ClubsApi</code> interface, annotating its methods with
<code>io.micronaut.http.annotation.Get</code> as described in the diagram.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, create <code>ClubsClient</code> by simply extending from <code>ClubsApi</code>.
Annotate the interface with <code>io.micronaut.http.client.Client("/")</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Finally, implement the controller <code>ClubController</code>. Annotate
the class with <code>io.micronaut.http.annotation.Controller("/")</code>, matching the path
specified on <code>ClubsClient</code>. Use <code>ClubService</code> to implement the actions by declaring
a constructor dependency on it.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The controller actions need to be annotated with <code>io.micronaut.http.annotation.Get</code> again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Finally, configure <code>logback.xml</code> to see some relevant output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;configuration&gt;</span>

    <span class="tok-c">&lt;!-- Default settings ... --&gt;</span>

    <span class="tok-nt">&lt;logger</span> <span class="tok-na">name=</span><span class="tok-s">&quot;clubs&quot;</span> <span class="tok-na">level=</span><span class="tok-s">&quot;DEBUG&quot;</span><span class="tok-nt">/&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-nt">&lt;logger</span> <span class="tok-na">name=</span><span class="tok-s">&quot;io.micronaut.http.client&quot;</span> <span class="tok-na">level=</span><span class="tok-s">&quot;TRACE&quot;</span><span class="tok-nt">/&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Debug level for our code</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This allows to see the HTTP request and responses from the HTTP clients.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Once you have it, write a test for everything:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-kd">class</span> <span class="tok-nc">ClubControllerSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Shared</span> <span class="tok-nd">@AutoCleanup</span> <span class="tok-n">EmbeddedServer</span> <span class="tok-n">embeddedServer</span> <span class="tok-o">=</span> <span class="tok-n">ApplicationContext</span><span class="tok-o">.</span><span class="tok-na">run</span><span class="tok-o">(</span><span class="tok-n">EmbeddedServer</span><span class="tok-o">)</span>
    <span class="tok-nd">@Shared</span> <span class="tok-n">ClubsClient</span> <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-n">ClubsClient</span><span class="tok-o">)</span>
    <span class="tok-nd">@Shared</span> <span class="tok-n">ClubService</span> <span class="tok-n">service</span> <span class="tok-o">=</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-n">ClubService</span><span class="tok-o">)</span>
    <span class="tok-nd">@Shared</span> <span class="tok-n">Long</span> <span class="tok-n">id</span>

    <span class="tok-nd">@Transactional</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-kt">void</span> <span class="tok-nf">setupSpec</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">id</span> <span class="tok-o">=</span> <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;Real Madrid CF&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Santiago Bernabeu&quot;</span><span class="tok-o">).</span><span class="tok-na">id</span>
        <span class="tok-n">service</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;FC Barcelona&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Camp Nou&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Transactional</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-kt">void</span> <span class="tok-nf">cleanupSpec</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Club</span><span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">()*.</span><span class="tok-na">delete</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test index&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span>
        <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Club</span><span class="tok-o">&gt;</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">listClubs</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">2</span>
    <span class="tok-o">}</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test find one&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">when:</span>
        <span class="tok-n">Club</span> <span class="tok-n">club</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">show</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">)</span>

        <span class="tok-nl">then:</span>
        <span class="tok-n">club</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Real Madrid CF&#39;</span>
        <span class="tok-n">club</span><span class="tok-o">.</span><span class="tok-na">stadium</span> <span class="tok-o">==</span> <span class="tok-s1">&#39;Santiago Bernabeu&#39;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Wrap write operations with <code>grails.gorm.transactions.Transactional</code></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_load_some_data_for_production_15_minutes">2.3. Load some data for production (15 minutes)</h3>
<div class="paragraph">
<p>During our tests, we have been seeding test data on demand, as it is a good
practise to isolate test data from test to test. However, for production, we
want some data loaded</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Let&#8217;s create a bean to load some data. Run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mn create-bean dataLoader</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Change it to look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@CompileStatic</span>
<span class="tok-nd">@Singleton</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nd">@Requires</span><span class="tok-o">(</span><span class="tok-n">notEnv</span> <span class="tok-o">=</span> <span class="tok-n">Environment</span><span class="tok-o">.</span><span class="tok-na">TEST</span><span class="tok-o">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-kd">class</span> <span class="tok-nc">DataLoader</span> <span class="tok-kd">implements</span> <span class="tok-n">ApplicationEventListener</span><span class="tok-o">&lt;</span><span class="tok-n">ServerStartupEvent</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="tok-kd">final</span> <span class="tok-n">ClubService</span> <span class="tok-n">clubService</span>

    <span class="tok-nf">DataLoader</span><span class="tok-o">(</span><span class="tok-n">ClubService</span> <span class="tok-n">clubService</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">clubService</span> <span class="tok-o">=</span> <span class="tok-n">clubService</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kt">void</span> <span class="tok-nf">onApplicationEvent</span><span class="tok-o">(</span><span class="tok-n">ServerStartupEvent</span> <span class="tok-n">event</span><span class="tok-o">)</span> <span class="tok-o">{</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">clubService</span><span class="tok-o">.</span><span class="tok-na">count</span><span class="tok-o">())</span> <span class="tok-o">{</span>
            <span class="tok-n">log</span><span class="tok-o">.</span><span class="tok-na">debug</span> <span class="tok-s2">&quot;Loading sample data&quot;</span>
            <span class="tok-n">clubService</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;Real Madrid CF&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Santiago Bernabeu&quot;</span><span class="tok-o">)</span>
            <span class="tok-n">clubService</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;FC Barcelona&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Camp Nou&quot;</span><span class="tok-o">)</span>
            <span class="tok-n">clubService</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;CD Leganes&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Butarque&quot;</span><span class="tok-o">)</span>
            <span class="tok-n">clubService</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-s2">&quot;Getafe CF&quot;</span><span class="tok-o">,</span> <span class="tok-s2">&quot;Coliseum&quot;</span><span class="tok-o">)</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>javax.inject.Singleton</code> will tell Micronaut to manage a single instance in
the application context.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>With <code>io.micronaut.context.annotation.Requires</code>, we ensure this runs on production,
which can be specified as not running under tests.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Make the bean a <code>io.micronaut.context.event.ApplicationEventListener</code> of an
<code>io.micronaut.runtime.server.event.ServerStartupEvent</code> event.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Implement the method loading some sample data.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, run the application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./gradlew run</pre>
</div>
</div>
<div class="paragraph">
<p>You should see an output similar to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>03:05:56.704 [main] DEBUG clubs.init.DataLoader - Loading sample data</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_register_the_service_in_consul_10_minutes">2.4. Register the service in Consul (10 minutes)</h3>
<div class="paragraph">
<p>We want the <code>clubs</code> microservice to be discoverable by the <code>fixtures</code> service.
So we will enable Micronaut&#8217;s Consul support for service discovery.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> First, add the neccessary dependency in <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-n">compile</span> <span class="tok-s2">&quot;io.micronaut:discovery-client&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, change <code>src/main/resources/application.yml</code> to define
the Consul configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-nn">---</span>
<span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">consul</span><span class="tok-p tok-p-Indicator">:</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">client</span><span class="tok-p tok-p-Indicator">:</span>
    <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">registration</span><span class="tok-p tok-p-Indicator">:</span>
      <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">enabled</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">true</span>
  <span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">defaultZone</span><span class="tok-p tok-p-Indicator">:</span> <span class="tok-s">&quot;${CONSUL_HOST:localhost}:${CONSUL_PORT:8500}&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Finally, run a Consul instance with Docker:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ docker run -d --name=dev-consul -e CONSUL_BIND_INTERFACE=eth0 -e CONSUL_UI_BETA=true -p 8500:8500 consul</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, if you run the application, you will see it registers
with Consul at startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew run
...
04:20:09.501 [nioEventLoopGroup-1-3] INFO  i.m.d.registration.AutoRegistration - Registered service [clubs] with Consul
...</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> If you go the <a href="http://localhost:8500/">Consul UI</a>, you can see
it shows as registered:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/consul.png" alt="consul">
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> You can run yet another instance of <code>clubs</code> on a different
shell, and see it registered. We will use them both with Micronaut&#8217;s load-balanced
HTTP client in the next exercise.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_the_fixtures_microservice_70_minutes">3. Creating the Fixtures microservice (70 minutes)</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Change to the <code>ex03/fixtures</code> directory to work on this exercise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this exercise we are creating the <code>fixtures</code> microservice.</p>
</div>
<div class="sect2">
<h3 id="_data_layer_35_minutes">3.1. Data layer (35 minutes)</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> First of all, run MongoDB with Docker:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ docker run -d --name=dev-mongo -p 27017:27017 mongo</pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Then, create the <code>Fixture</code> domain class with the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-n">ObjectId</span> <span class="tok-n">id</span>
<span class="tok-n">Long</span> <span class="tok-n">homeClubId</span>
<span class="tok-n">Long</span> <span class="tok-n">awayClubId</span>

<span class="tok-n">Short</span> <span class="tok-n">homeScore</span>
<span class="tok-n">Short</span> <span class="tok-n">awayScore</span>

<span class="tok-n">Date</span> <span class="tok-n">date</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we are only storing club&#8217;s ids. When rendering fixture details,
we will use Micronaut&#8217;s HTTP client to fetch details from the <code>clubs</code> microservice.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> The next thing we need is an HTTP client for the <code>clubs</code> microservice. Create one with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mn create-client clubs</pre>
</div>
</div>
<div class="paragraph">
<p>Before actually mapping any endpoint, we are going to create the following hierarchy:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/clients-diagram.png" alt="clients diagram">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClubsApi</code> is the interface that contains the client endpoint mappings.</p>
</li>
<li>
<p><code>ClubsClient</code> is the production client, is annotated with <code>@Client</code> and simply
extends from <code>ClubsApi</code>.</p>
</li>
<li>
<p><code>ClubsClientMock</code> is a mocking client (resides in <code>src/test/groovy</code>), is annotated
with <code>@Fallback</code>, and implements <code>ClubsApi</code> by returning hardcoded instances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is how <code>ClubsApi</code> looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-kd">interface</span> <span class="tok-nc">ClubsApi</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Get</span><span class="tok-o">(</span><span class="tok-s2">&quot;/{id}&quot;</span><span class="tok-o">)</span>
    <span class="tok-n">Maybe</span><span class="tok-o">&lt;</span><span class="tok-n">Club</span><span class="tok-o">&gt;</span> <span class="tok-n">findTeam</span><span class="tok-o">(</span><span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">)</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are using a reactive type in the HTTP client response, so that is a hint
for Micronaut to make it non-blocking.</p>
</div>
<div class="paragraph">
<p>Then, the production client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-nd">@Client</span><span class="tok-o">(</span><span class="tok-s2">&quot;clubs&quot;</span><span class="tok-o">)</span>    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">interface</span> <span class="tok-nc">ClubsClient</span> <span class="tok-kd">extends</span> <span class="tok-n">ClubsApi</span> <span class="tok-o">{}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>"clubs"</code> is the Consul name for the Clubs microservice (which registers
itself with the <code>micronaut.application.name</code> property).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, the mocking client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-nd">@Fallback</span>
<span class="tok-kd">class</span> <span class="tok-nc">ClubsClientMock</span> <span class="tok-kd">implements</span> <span class="tok-n">ClubsApi</span><span class="tok-o">{</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-n">Maybe</span><span class="tok-o">&lt;</span><span class="tok-n">Club</span><span class="tok-o">&gt;</span> <span class="tok-n">findTeam</span><span class="tok-o">(</span><span class="tok-n">Long</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">id</span> <span class="tok-o">==</span> <span class="tok-mi">1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">Maybe</span><span class="tok-o">.</span><span class="tok-na">just</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Club</span><span class="tok-o">(</span><span class="tok-nl">name:</span> <span class="tok-s2">&quot;CD Leganes&quot;</span><span class="tok-o">,</span> <span class="tok-nl">stadium:</span> <span class="tok-s2">&quot;Butarque&quot;</span><span class="tok-o">))</span>
        <span class="tok-o">}</span> <span class="tok-k">else</span> <span class="tok-o">{</span>
            <span class="tok-n">Maybe</span><span class="tok-o">.</span><span class="tok-na">just</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Club</span><span class="tok-o">(</span><span class="tok-nl">name:</span> <span class="tok-s2">&quot;Getafe CF&quot;</span><span class="tok-o">,</span> <span class="tok-nl">stadium:</span> <span class="tok-s2">&quot;Coliseum&quot;</span><span class="tok-o">))</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> We also need a <code>Club</code> POGO to capture the JSON response from <code>clubs</code>. Define
it with 2 string fields: <code>name</code> and <code>stadium</code>.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now let&#8217;s create a GORM Data Service for <code>Fixture</code> (named
<code>FixtureService</code>). In this case, instead of an interface, we are using an abstract
class, as we are going to implement our own custom method.</p>
</div>
<div class="paragraph">
<p>First, define the operations that we want GORM to implement automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-c1">//GORM operations</span>
<span class="tok-kd">abstract</span> <span class="tok-n">Fixture</span> <span class="tok-nf">save</span><span class="tok-o">(</span><span class="tok-nd">@Valid</span> <span class="tok-n">Fixture</span> <span class="tok-n">fixture</span><span class="tok-o">)</span>
<span class="tok-kd">abstract</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Fixture</span><span class="tok-o">&gt;</span> <span class="tok-n">findAll</span><span class="tok-o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this service, we need to transform <code>Fixture</code> instances into a data transfer
object that contains club names and the stadium of the game.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Let&#8217;s call this DTO <code>FixtureView</code> and add the following fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-n">String</span> <span class="tok-n">homeClubName</span>
<span class="tok-n">String</span> <span class="tok-n">awayClubName</span>

<span class="tok-n">String</span> <span class="tok-n">stadium</span>

<span class="tok-n">Short</span> <span class="tok-n">homeScore</span>
<span class="tok-n">Short</span> <span class="tok-n">awayScore</span>

<span class="tok-n">Date</span> <span class="tok-n">date</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, in <code>FixtureService</code> we need to implement a method that takes a <code>Fixture</code>
instance and converts it to a <code>FixtureView</code> instance. You first need to inject
the <code>ClubsClient</code> we defined before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-nd">@Inject</span>
<span class="tok-n">ClubsClient</span> <span class="tok-n">clubsClient</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, implement the method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-n">Maybe</span><span class="tok-o">&lt;</span><span class="tok-n">FixtureView</span><span class="tok-o">&gt;</span> <span class="tok-n">toView</span><span class="tok-o">(</span><span class="tok-n">Fixture</span> <span class="tok-n">fixture</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Maybe</span><span class="tok-o">.</span><span class="tok-na">zip</span><span class="tok-o">(</span><span class="tok-n">clubsClient</span><span class="tok-o">.</span><span class="tok-na">findTeam</span><span class="tok-o">(</span><span class="tok-n">fixture</span><span class="tok-o">.</span><span class="tok-na">homeClubId</span><span class="tok-o">),</span> <span class="tok-n">clubsClient</span><span class="tok-o">.</span><span class="tok-na">findTeam</span><span class="tok-o">(</span><span class="tok-n">fixture</span><span class="tok-o">.</span><span class="tok-na">awayClubId</span><span class="tok-o">))</span> <span class="tok-o">{</span> <span class="tok-n">Club</span> <span class="tok-n">homeClub</span><span class="tok-o">,</span> <span class="tok-n">Club</span> <span class="tok-n">awayClub</span> <span class="tok-o">-&gt;</span>
        <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-nf">FixtureView</span><span class="tok-o">(</span>
                <span class="tok-nl">date:</span> <span class="tok-n">fixture</span><span class="tok-o">.</span><span class="tok-na">date</span><span class="tok-o">,</span>
                <span class="tok-nl">homeClubName:</span> <span class="tok-n">homeClub</span><span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">,</span>
                <span class="tok-nl">awayClubName:</span> <span class="tok-n">awayClub</span><span class="tok-o">.</span><span class="tok-na">name</span><span class="tok-o">,</span>
                <span class="tok-nl">stadium:</span> <span class="tok-n">homeClub</span><span class="tok-o">.</span><span class="tok-na">stadium</span><span class="tok-o">,</span>
                <span class="tok-nl">homeScore:</span> <span class="tok-n">fixture</span><span class="tok-o">.</span><span class="tok-na">homeScore</span><span class="tok-o">,</span>
                <span class="tok-nl">awayScore:</span> <span class="tok-n">fixture</span><span class="tok-o">.</span><span class="tok-na">awayScore</span>
        <span class="tok-o">)</span>
    <span class="tok-o">}</span> <span class="tok-k">as</span> <span class="tok-n">Maybe</span><span class="tok-o">&lt;</span><span class="tok-n">FixtureView</span><span class="tok-o">&gt;</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the HTTP client is non-blocking, we can retrieve details about both clubs in
parallel, and then compose our response once we get both HTTP responses back from
the other microservice.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, let&#8217;s write a test for it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-kn">package</span> <span class="tok-n">fixtures</span>

<span class="tok-kn">import</span> <span class="tok-nn">fixtures.domain.Fixture</span>
<span class="tok-kn">import</span> <span class="tok-nn">fixtures.service.FixtureService</span>
<span class="tok-kn">import</span> <span class="tok-nn">fixtures.view.FixtureView</span>
<span class="tok-kn">import</span> <span class="tok-nn">io.micronaut.context.ApplicationContext</span>
<span class="tok-kn">import</span> <span class="tok-nn">io.micronaut.runtime.server.EmbeddedServer</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.AutoCleanup</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Shared</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-kd">class</span> <span class="tok-nc">FixtureServiceSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Shared</span> <span class="tok-nd">@AutoCleanup</span> <span class="tok-n">EmbeddedServer</span> <span class="tok-n">embeddedServer</span> <span class="tok-o">=</span> <span class="tok-n">ApplicationContext</span><span class="tok-o">.</span><span class="tok-na">run</span><span class="tok-o">(</span><span class="tok-n">EmbeddedServer</span><span class="tok-o">)</span>
    <span class="tok-nd">@Shared</span> <span class="tok-n">FixtureService</span> <span class="tok-n">fixtureService</span> <span class="tok-o">=</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-n">FixtureService</span><span class="tok-o">)</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;it can get full details of a fixture&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
        <span class="tok-n">Date</span> <span class="tok-n">now</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">()</span>
        <span class="tok-n">Fixture</span> <span class="tok-n">fixture</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Fixture</span><span class="tok-o">(</span><span class="tok-nl">homeClubId:</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">homeScore:</span> <span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">awayClubId:</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">awayScore:</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-n">now</span><span class="tok-o">)</span>
        <span class="tok-n">fixture</span> <span class="tok-o">=</span> <span class="tok-n">fixtureService</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-n">fixture</span><span class="tok-o">)</span>

        <span class="tok-nl">when:</span>
        <span class="tok-n">FixtureView</span> <span class="tok-n">view</span> <span class="tok-o">=</span> <span class="tok-n">fixtureService</span><span class="tok-o">.</span><span class="tok-na">toView</span><span class="tok-o">(</span><span class="tok-n">fixture</span><span class="tok-o">).</span><span class="tok-na">blockingGet</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span>
        <span class="tok-n">view</span><span class="tok-o">.</span><span class="tok-na">date</span> <span class="tok-o">==</span> <span class="tok-n">now</span>
        <span class="tok-n">view</span><span class="tok-o">.</span><span class="tok-na">homeClubName</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;CD Leganes&quot;</span>
        <span class="tok-n">view</span><span class="tok-o">.</span><span class="tok-na">homeScore</span> <span class="tok-o">==</span> <span class="tok-mi">5</span>
        <span class="tok-n">view</span><span class="tok-o">.</span><span class="tok-na">awayClubName</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Getafe CF&quot;</span>
        <span class="tok-n">view</span><span class="tok-o">.</span><span class="tok-na">awayScore</span> <span class="tok-o">==</span> <span class="tok-mi">0</span>
        <span class="tok-n">view</span><span class="tok-o">.</span><span class="tok-na">stadium</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Butarque&quot;</span>

        <span class="tok-nl">cleanup:</span>
        <span class="tok-n">fixture</span><span class="tok-o">.</span><span class="tok-na">delete</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure it passes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rest_api_35_minutes">3.2. REST API (35 minutes)</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Let&#8217;s create a controller for displaying fixtures:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mn create-controller fixture</pre>
</div>
</div>
<div class="paragraph">
<p>Declare a constructor dependency on <code>FixtureService</code> so that Micronaut knows it
needs to be injected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-n">FixtureService</span> <span class="tok-n">fixtureService</span>

<span class="tok-nf">FixtureController</span><span class="tok-o">(</span><span class="tok-n">FixtureService</span> <span class="tok-n">fixtureService</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">fixtureService</span> <span class="tok-o">=</span> <span class="tok-n">fixtureService</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, implement the action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-nd">@Get</span><span class="tok-o">(</span><span class="tok-s2">&quot;/&quot;</span><span class="tok-o">)</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">FixtureView</span><span class="tok-o">&gt;</span> <span class="tok-n">findAll</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">fixtureService</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">().</span><span class="tok-na">collect</span> <span class="tok-o">{</span>
        <span class="tok-n">fixtureService</span><span class="tok-o">.</span><span class="tok-na">toView</span><span class="tok-o">(</span><span class="tok-n">it</span><span class="tok-o">).</span><span class="tok-na">blockingGet</span><span class="tok-o">()</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <code>FixtureService.toView()</code> is reactive as it returns
a <code>Maybe&lt;FixtureView&gt;</code>. It could be possible to change the action implementation
so that the return type would be <code>Flowable&lt;FixtureView&gt;</code>, but it would complicate
this example. Mastering reactive programming is not the main purpose of this
workshop, so for the sake of simplicity, we are introducing a blocking call.</p>
</div>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-hand-o-right"></i></span> Now, we need to test it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="tok-kn">package</span> <span class="tok-n">fixtures</span>

<span class="tok-kn">import</span> <span class="tok-nn">fixtures.client.FixtureClient</span>
<span class="tok-kn">import</span> <span class="tok-nn">fixtures.domain.Fixture</span>
<span class="tok-kn">import</span> <span class="tok-nn">fixtures.service.FixtureService</span>
<span class="tok-kn">import</span> <span class="tok-nn">fixtures.view.FixtureView</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">io.micronaut.context.ApplicationContext</span>
<span class="tok-kn">import</span> <span class="tok-nn">io.micronaut.runtime.server.EmbeddedServer</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.AutoCleanup</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Shared</span>
<span class="tok-kn">import</span> <span class="tok-nn">spock.lang.Specification</span>

<span class="tok-kd">class</span> <span class="tok-nc">FixtureControllerSpec</span> <span class="tok-kd">extends</span> <span class="tok-n">Specification</span> <span class="tok-o">{</span>

    <span class="tok-nd">@Shared</span> <span class="tok-nd">@AutoCleanup</span> <span class="tok-n">EmbeddedServer</span> <span class="tok-n">embeddedServer</span> <span class="tok-o">=</span> <span class="tok-n">ApplicationContext</span><span class="tok-o">.</span><span class="tok-na">run</span><span class="tok-o">(</span><span class="tok-n">EmbeddedServer</span><span class="tok-o">)</span>
    <span class="tok-nd">@Shared</span> <span class="tok-n">FixtureClient</span> <span class="tok-n">client</span> <span class="tok-o">=</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-n">FixtureClient</span><span class="tok-o">)</span>
    <span class="tok-nd">@Shared</span> <span class="tok-n">FixtureService</span> <span class="tok-n">fixtureService</span> <span class="tok-o">=</span> <span class="tok-n">embeddedServer</span><span class="tok-o">.</span><span class="tok-na">applicationContext</span><span class="tok-o">.</span><span class="tok-na">getBean</span><span class="tok-o">(</span><span class="tok-n">FixtureService</span><span class="tok-o">)</span>

    <span class="tok-kt">void</span> <span class="tok-s2">&quot;test index&quot;</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-nl">given:</span>
        <span class="tok-n">Fixture</span> <span class="tok-n">fixture</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Fixture</span><span class="tok-o">(</span><span class="tok-nl">homeClubId:</span> <span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-nl">homeScore:</span> <span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-nl">awayClubId:</span> <span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-nl">awayScore:</span> <span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-nl">date:</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">())</span>
        <span class="tok-n">fixtureService</span><span class="tok-o">.</span><span class="tok-na">save</span><span class="tok-o">(</span><span class="tok-n">fixture</span><span class="tok-o">)</span>

        <span class="tok-nl">when:</span>
        <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">FixtureView</span><span class="tok-o">&gt;</span> <span class="tok-n">views</span> <span class="tok-o">=</span> <span class="tok-n">client</span><span class="tok-o">.</span><span class="tok-na">findAll</span><span class="tok-o">()</span>

        <span class="tok-nl">then:</span>
        <span class="tok-n">views</span><span class="tok-o">.</span><span class="tok-na">first</span><span class="tok-o">().</span><span class="tok-na">homeClubName</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;CD Leganes&quot;</span>
        <span class="tok-n">views</span><span class="tok-o">.</span><span class="tok-na">first</span><span class="tok-o">().</span><span class="tok-na">awayClubName</span> <span class="tok-o">==</span> <span class="tok-s2">&quot;Getafe CF&quot;</span>

        <span class="tok-nl">cleanup:</span>
        <span class="tok-n">fixture</span><span class="tok-o">.</span><span class="tok-na">delete</span><span class="tok-o">(</span><span class="tok-nl">flush:</span> <span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the test to ensure it passes.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-07-25 10:17:04 CDT
</div>
</div>
</body>
</html>